# Drum Score Editor API
This is the back end for the next generation web presence for Drum Score Editor, the world's most efficient score writing tool for rudimental drumming, using derivatives of the Swiss Basel notation, e.g. Scottish Pipe Band Drumming.

This is as much a learning exercise for me, in how to leverage modern tools and techniques for building microservice or function style development, as well as providing the services needed for the front end Single Page App (see https://github.com/alanwhite/dseweb).

Please feel free to contribute to the code, or provide me with feedback to help improve the experience for everyone, and my learning!

## Structure

* functions - contains the source to all the functions provided
  * app - contains the functions which are core to the app, and not the underlying cloud provider (huge exception being the database layer hasn't been abstracted yet)
    * accounts.js - updates the main account domain in SimpleDB, contains user as the main Item, with licenses as Attributes
    * licenses.js - handles the creation of new encrypted licenses
    * payments.js - processes the payments workflow from a validated PayPal notification
    * pbewithmd5anddes.js - implements the rather old and relatively insecure Java encryption mechanism to create the encrypted license. The main Drum Score Editor software decrypts the token this produces as proof of license. Gloriously bypassed these days, and a new mechanism is required!
    * validator.js - ensures that the JWT coming from the front end is valid
  * aws - contains the functions specific to handling the AWS Lambda interface, the thinking is that other providers 'glue' layer between the actual app and the provider's proprietary interfaces will live in different folders
    * licenses - contains the handler for the /${stage}/licenses/ GET endpoint
    * payments - contains the handler for the /${stage}/payments/paypal POST endpoint

* serverless.yml - configuration file for sls to manage the AWS Cloudformation template and deploy the site to AWS S3 & Lambda & HTTP API Gateway

* secrets.${stage}.yml - contains the unencrypted secrets, this is excluded from the github repo for obvious reasons and is generated by decrypting the file of the same name suffixed with .encrypted - see the sls (serverless.com) documentation, only I have the passphrase

Various other standard files and folders have their usual meaning, e.g. node_modules and so on.

## Functionality

Payments - validates an IPN from PayPal, logs it, cuts a license and stores it in the users SimpleDB entry.
Licenses - provides front end access to a users licenses

## Contact

Drum Score Editor is on facebook at https://facebook.com/DrumScoreEditor, and twitter as \@DrumScoreEditor. Or old fashioned email at alan@whiteware.org.

This website will replace https://www.drumscore.scot (production) and https://uat.drumscore.scot (User Acceptance Testing) when done.
